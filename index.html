<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <?!= include("css"); ?>
  <div class="container">
    <!-- User Info -->
    <div id="user-info" class="alert alert-primary"></div>

    <!-- Main Folder Selection -->
    <div id="main-folder-section" class="card">
      <div class="card-body">
        <h5 class="card-title">Main Folder</h5>
        <div class="mb-3">
          <select id="mainFolderSelect" class="form-select" onchange="handleMainFolderChange()">
            <!-- Main folders will be dynamically loaded -->
          </select>
        </div>
        <div id="addMainFolderWrapper">
          <button id="addMainFolderButton" class="btn btn-primary" onclick="openAddFolderModal()">Add Main Folder</button>
        </div>
      </div>
    </div>

    <!-- Subfolder Selection -->
    <div class="card" id="subfolderCard" style="display: none;">
      <div class="card-body">
        <h5 class="card-title">Subfolder</h5>
        <div class="mb-3">
          <select id="subFolderSelect" class="form-select" onchange="handleSubfolderChange()">
            <!-- Subfolders will be dynamically loaded -->
          </select>
        </div>
        <div id="addSubfolderWrapper">
          <button id="addSubfolderButton" class="btn btn-primary" onclick="openAddFolderModal(true)">Add Subfolder</button>
        </div>
      </div>
    </div>

    <!-- Document Upload -->
    <div class="card" id="uploadCard" style="display: none;">
      <div class="card-body">
        <div class="mb-3">
          <label for="fileNameInput" class="form-label">File Name</label>
          <input type="text" id="fileNameInput" class="form-control" placeholder="Enter file name (Optional)">
        </div>
        <div class="mb-3">
          <input type="file" id="fileUpload" class="form-control">
        </div>
        <button class="btn btn-success" onclick="uploadDocument()">Upload Document</button>
        <div id="uploadMessage" class="alert alert-info mt-3" style="display: none;"></div>
      </div>
    </div>

    <!-- Admin Section -->
    <div id="admin-section" class="card" style="display: none;">
      <div class="card-body">
        <!-- User Management -->
        <h5 class="card-title">User Management - Add New User</h5>
        <form id="addUserForm">
          <div class="mb-3">
            <input type="email" class="form-control" id="userEmailInput" placeholder="Enter user email" required>
          </div>
          <div class="mb-3">
            <select id="userRoleSelect" class="form-select">
              <option value="User">User</option>
              <option value="Admin">Admin</option>
            </select>
          </div>
          <button type="button" class="btn btn-primary" onclick="addUser()">Add User</button>
          <div id="userMessage" class="alert mt-3" style="display: none;"></div>
        </form>

        <!-- Admin Controls -->
        <hr>
        <h5 class="card-title">Admin Controls</h5>
        <button id="logUploadsButton" class="btn btn-info" onclick="triggerLogDirectUploads()">Log Direct Uploads</button>
        <div id="logUploadsMessage" class="alert mt-3" style="display: none;"></div>
      </div>
    </div>

    <!-- Folder Creation Modal -->
    <div class="modal fade" id="addFolderModal" tabindex="-1" aria-labelledby="addFolderModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addFolderModalLabel">Add New Folder</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addFolderForm">
              <div class="mb-3">
                <input type="text" class="form-control" id="folderNameInput" placeholder="Enter folder name" required>
              </div>
              <div id="folderMessage" class="alert alert-danger mt-2" style="display: none;"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="handleAddFolder()">Add Folder</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div style="font-size: 10px; margin-top: 5px; text-align: center; color: rgb(117, 117, 117);">
    This application was created by a Google Apps Script user
  </div>

  <?!= include("js"); ?>
</body>
</html>
